<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp Test</title>
    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
        }
        button {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #ff6666;
        }
        .log {
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background-color: #4CAF50; }
        .error { background-color: #f44336; }
        .info { background-color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Telegram WebApp Test</h1>
        
        <div class="test-section">
            <h2>üì± Telegram WebApp Info</h2>
            <div id="telegramInfo" class="log">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="test-section">
            <h2>üë§ User Info</h2>
            <div id="userInfo" class="log">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="test-section">
            <h2>üß™ API Tests</h2>
            <button onclick="testSaveProgress()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 3)</button>
            <button onclick="testSaveForm()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É</button>
            <button onclick="testGetUserData()">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <div id="apiStatus" class="status info">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            <div id="apiLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Console Logs</h2>
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            <div id="consoleLog" class="log"></div>
        </div>
    </div>

    <script src="progress.js"></script>
    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== TELEGRAM WEBAPP TEST –ó–ê–ü–£–©–ï–ù ===');
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Telegram WebApp
            collectTelegramInfo();
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            collectUserInfo();
        });

        function collectTelegramInfo() {
            const telegramInfo = {
                isAvailable: !!(window.Telegram && window.Telegram.WebApp),
                version: window.Telegram?.WebApp?.version || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                platform: window.Telegram?.WebApp?.platform || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                colorScheme: window.Telegram?.WebApp?.colorScheme || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                themeParams: window.Telegram?.WebApp?.themeParams || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                initData: window.Telegram?.WebApp?.initData || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                initDataUnsafe: window.Telegram?.WebApp?.initDataUnsafe || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                user: window.Telegram?.WebApp?.initDataUnsafe?.user || '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
            };
            
            document.getElementById('telegramInfo').textContent = JSON.stringify(telegramInfo, null, 2);
        }

        function collectUserInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const userInfo = {
                urlParams: Object.fromEntries(urlParams),
                progressManager: window.progressManager ? {
                    userId: window.progressManager.userId,
                    apiBase: window.progressManager.apiBase,
                    isMobile: window.progressManager.isMobile,
                    isTelegramWebApp: window.progressManager.isTelegramWebApp
                } : '–ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'
            };
            
            document.getElementById('userInfo').textContent = JSON.stringify(userInfo, null, 2);
        }

        async function testSaveProgress() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            try {
                await window.progressManager.saveProgress(3);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!';
                logDiv.textContent = '–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É 3';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞!';
                logDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testSaveForm() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            try {
                const formData = {
                    age: "28",
                    occupation: "Telegram —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
                    income: "85000 —Ä—É–±/–º–µ—Å",
                    motivation: "10 –∏–∑ 10",
                    teamwork: "–û—á–µ–Ω—å —Ö–æ—á—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Telegram –∫–æ–º–∞–Ω–¥–µ"
                };
                
                await window.progressManager.saveFormData(formData);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!';
                logDiv.textContent = '–¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã!';
                logDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testGetUserData() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            try {
                const userData = await window.progressManager.getUserData();
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã!';
                logDiv.textContent = JSON.stringify(userData, null, 2);
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö!';
                logDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        function clearLogs() {
            document.getElementById('consoleLog').textContent = '';
            document.getElementById('apiLog').textContent = '';
        }
    </script>
</body>
</html> 