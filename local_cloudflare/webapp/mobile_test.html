<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
            font-size: 14px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
        }
        button {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #ff6666;
        }
        .log {
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        input, textarea {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background-color: #4CAF50; }
        .error { background-color: #f44336; }
        .info { background-color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã</h1>
        
        <div class="test-section">
            <h2>üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
            <div id="deviceInfo" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>üîó –°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div id="networkInfo" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
            <div id="userInfo" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>üß™ –¢–µ—Å—Ç API</h2>
            <button onclick="testApiConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å API</button>
            <button onclick="testSaveProgress()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 5)</button>
            <button onclick="testSaveForm()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É</button>
            <div id="apiStatus" class="status info">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            <div id="apiLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>üìù –¢–µ—Å—Ç —Ñ–æ—Ä–º—ã</h2>
            <input type="text" id="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" value="25">
            <input type="text" id="occupation" placeholder="–ü—Ä–æ—Ñ–µ—Å—Å–∏—è" value="–ú–æ–±–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫">
            <input type="text" id="income" placeholder="–î–æ—Ö–æ–¥" value="70000 —Ä—É–±/–º–µ—Å">
            <input type="text" id="motivation" placeholder="–ú–æ—Ç–∏–≤–∞—Ü–∏—è" value="9 –∏–∑ 10">
            <textarea id="teamwork" placeholder="–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞" rows="3">–ì–æ—Ç–æ–≤ –∫ –º–æ–±–∏–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç–µ</textarea>
            <button onclick="saveFormData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            <div id="formStatus" class="status info">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</div>
        </div>
        
        <div class="test-section">
            <h2>üìä –õ–æ–≥–∏ –∫–æ–Ω—Å–æ–ª–∏</h2>
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            <div id="consoleLog" class="log"></div>
        </div>
    </div>

    <script src="progress.js"></script>
    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== –ú–û–ë–ò–õ–¨–ù–´–ô –¢–ï–°–¢ –ó–ê–ü–£–©–ï–ù ===');
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            collectDeviceInfo();
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å–µ—Ç–µ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            collectNetworkInfo();
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            collectUserInfo();
        });

        function collectDeviceInfo() {
            const deviceInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è',
                screen: {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight
                },
                window: {
                    innerWidth: window.innerWidth,
                    innerHeight: window.innerHeight,
                    outerWidth: window.outerWidth,
                    outerHeight: window.outerHeight
                }
            };
            
            document.getElementById('deviceInfo').textContent = JSON.stringify(deviceInfo, null, 2);
        }

        function collectNetworkInfo() {
            const networkInfo = {
                location: {
                    href: window.location.href,
                    origin: window.location.origin,
                    protocol: window.location.protocol,
                    host: window.location.host,
                    hostname: window.location.hostname,
                    port: window.location.port,
                    pathname: window.location.pathname,
                    search: window.location.search
                },
                localStorage: {
                    user_id: localStorage.getItem('user_id'),
                    telegram_user_id: localStorage.getItem('telegram_user_id')
                }
            };
            
            document.getElementById('networkInfo').textContent = JSON.stringify(networkInfo, null, 2);
        }

        function collectUserInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const userInfo = {
                urlParams: Object.fromEntries(urlParams),
                progressManager: window.progressManager ? {
                    userId: window.progressManager.userId,
                    apiBase: window.progressManager.apiBase,
                    isMobile: window.progressManager.isMobile
                } : '–ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'
            };
            
            document.getElementById('userInfo').textContent = JSON.stringify(userInfo, null, 2);
        }

        async function testApiConnection() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            statusDiv.className = 'status info';
            statusDiv.textContent = '–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...';
            logDiv.textContent = '';
            
            try {
                if (!window.progressManager) {
                    throw new Error('ProgressManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                const userData = await window.progressManager.getUserData();
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!';
                logDiv.textContent = JSON.stringify(userData, null, 2);
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!';
                logDiv.textContent = `–û—à–∏–±–∫–∞: ${error.message}\n\n–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤:\n${error.stack}`;
            }
        }

        async function testSaveProgress() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            try {
                await window.progressManager.saveProgress(5);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!';
                logDiv.textContent += '\n–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É 5';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞!';
                logDiv.textContent += `\n–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testSaveForm() {
            const statusDiv = document.getElementById('apiStatus');
            const logDiv = document.getElementById('apiLog');
            
            try {
                const formData = {
                    age: "30",
                    occupation: "–ú–æ–±–∏–ª—å–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
                    income: "90000 —Ä—É–±/–º–µ—Å",
                    motivation: "10 –∏–∑ 10",
                    teamwork: "–û—á–µ–Ω—å —Ö–æ—á—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –º–æ–±–∏–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ"
                };
                
                await window.progressManager.saveFormData(formData);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!';
                logDiv.textContent += '\n–¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã!';
                logDiv.textContent += `\n–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function saveFormData() {
            const statusDiv = document.getElementById('formStatus');
            
            try {
                const formData = {
                    age: document.getElementById('age').value,
                    occupation: document.getElementById('occupation').value,
                    income: document.getElementById('income').value,
                    motivation: document.getElementById('motivation').value,
                    teamwork: document.getElementById('teamwork').value
                };
                
                await window.progressManager.saveFormData(formData);
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ –§–æ—Ä–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã!';
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã:', error);
            }
        }

        function clearLogs() {
            document.getElementById('consoleLog').textContent = '';
            document.getElementById('apiLog').textContent = '';
        }
    </script>
</body>
</html> 